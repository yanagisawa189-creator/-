<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ«ãƒšãƒ³ã‚¹ã‚­ãƒ¼ç›£ç£
    </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            padding: 20px 0;
            box-shadow: 0 4px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 5px;
        }

        .nav-tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
        }

        .nav-tab:hover {
            background: rgba(102,126,234,0.1);
            color: #667eea;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 15px rgba(102,126,234,0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 60px 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102,126,234,0.05);
        }

        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }
        
        .upload-tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
        }
        
        .upload-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
        }
        
        .upload-tab:hover {
            background: rgba(102,126,234,0.1);
            color: #667eea;
        }
        
        .upload-tab.active {
            background: #667eea;
            color: white;
        }
        
        .upload-content {
            display: none;
        }
        
        .upload-content.active {
            display: block;
        }
        
        .youtube-input-area {
            text-align: center;
            padding: 40px 30px;
        }
        
        .url-input-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .youtube-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .youtube-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .load-youtube-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .load-youtube-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .analysis-panel {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .video-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .video-player {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .video-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .analysis-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 6px 25px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .checklist li:last-child {
            border-bottom: none;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkbox.checked {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .score-display {
            text-align: center;
            margin: 20px 0;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#667eea 0% var(--score), #e9ecef var(--score) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
        }

        .score-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            position: relative;
            z-index: 1;
        }

        .recommendations {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .recommendation-item {
            background: white;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .recommendation-item:last-child {
            margin-bottom: 0;
        }

        .recommendation-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .recommendation-desc {
            color: #666;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 6px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-history {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            color: #666;
            font-size: 0.9rem;
        }

        .history-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .improvement {
            color: #28a745;
            font-size: 0.8rem;
        }

        .decline {
            color: #dc3545;
            font-size: 0.8rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .analysis-panel {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .video-controls {
                flex-direction: column;
                align-items: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>ğŸ¿</span>
                <span>ã‚¹ã‚­ãƒ¼æ»‘èµ°åˆ†æã‚·ã‚¹ãƒ†ãƒ </span>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" data-section="upload">å‹•ç”»åˆ†æ</button>
                <button class="nav-tab" data-section="progress">é€²æ­©è¨˜éŒ²</button>
                <button class="nav-tab" data-section="training">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- å‹•ç”»åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="upload" class="section active">
            <div class="upload-section">
                <div class="upload-tabs">
                    <button class="upload-tab active" data-type="file">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«</button>
                    <button class="upload-tab" data-type="youtube">ğŸ“º YouTube</button>
                </div>
                
                <div id="fileUpload" class="upload-content active">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">ğŸ¥</div>
                        <div class="upload-text">ã‚¹ã‚­ãƒ¼æ»‘èµ°å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                        <div class="upload-subtext">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</div>
                        <div class="upload-subtext">å¯¾å¿œå½¢å¼: MP4, MOV, AVI (æœ€å¤§100MB)</div>
                    </div>
                    <input type="file" id="videoInput" class="file-input" accept="video/*">
                </div>
                
                <div id="youtubeUpload" class="upload-content">
                    <div class="youtube-input-area">
                        <div class="upload-icon">ğŸ“º</div>
                        <div class="upload-text">YouTubeã‚¹ã‚­ãƒ¼å‹•ç”»ã®URLã‚’å…¥åŠ›</div>
                        <div class="url-input-group">
                            <input type="url" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." class="youtube-input">
                            <button class="load-youtube-btn" onclick="loadYouTubeVideo()">èª­ã¿è¾¼ã¿</button>
                        </div>
                        <div class="upload-subtext">YouTubeå‹•ç”»ã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</div>
                    </div>
                </div>
            </div>

            <div id="analysisPanel" class="analysis-panel hidden">
                <div class="video-section">
                    <div class="video-container" id="videoContainer">
                        <video id="videoPlayer" class="video-player" controls style="display: none;">
                            ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
                        </video>
                        <iframe id="youtubePlayer" class="video-player" style="display: none;" 
                                frameborder="0" allowfullscreen>
                        </iframe>
                    </div>
                    
                    <div class="video-controls">
                        <button class="control-btn btn-primary" onclick="analyzeVideo()">ğŸ” AIåˆ†æé–‹å§‹</button>
                        <button class="control-btn btn-secondary" onclick="playSlowMotion()">âª ã‚¹ãƒ­ãƒ¼å†ç”Ÿ</button>
                        <button class="control-btn btn-secondary" onclick="frameByFrame()">â¯ï¸ ã‚³ãƒé€ã‚Š</button>
                        <button class="control-btn btn-secondary" onclick="resetVideo()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>

                <div class="analysis-sidebar">
                    <div class="analysis-card">
                        <h3 class="card-title">
                            <span>ğŸ¯</span>
                            æŠ€è¡“è©•ä¾¡
                        </h3>
                        <div class="score-display">
                            <div class="score-circle" style="--score: 0%">
                                <span class="score-number" id="totalScore">--</span>
                            </div>
                            <div>ç·åˆã‚¹ã‚³ã‚¢</div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3 class="card-title">
                            <span>ğŸ“</span>
                            åˆ†æãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
                        </h3>
                        <ul class="checklist" id="analysisChecklist">
                            <li>
                                <div class="checkbox" data-category="posture"></div>
                                <span>åŸºæœ¬å§¿å‹¢ (å‰å‚¾ãƒ»é‡å¿ƒ)</span>
                            </li>
                            <li>
                                <div class="checkbox" data-category="edging"></div>
                                <span>ã‚¨ãƒƒã‚¸ãƒ³ã‚°æŠ€è¡“</span>
                            </li>
                            <li>
                                <div class="checkbox" data-category="turning"></div>
                                <span>ã‚¿ãƒ¼ãƒ³æŠ€è¡“</span>
                            </li>
                            <li>
                                <div class="checkbox" data-category="rhythm"></div>
                                <span>ãƒªã‚ºãƒ ãƒ»ãƒãƒ©ãƒ³ã‚¹</span>
                            </li>
                            <li>
                                <div class="checkbox" data-category="line"></div>
                                <span>ãƒ©ã‚¤ãƒ³å–ã‚Š</span>
                            </li>
                            <li>
                                <div class="checkbox" data-category="speed"></div>
                                <span>ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</span>
                            </li>
                        </ul>
                    </div>

                    <div class="analysis-card">
                        <h3 class="card-title">
                            <span>ğŸ’¡</span>
                            æ”¹å–„ææ¡ˆ
                        </h3>
                        <div class="recommendations" id="recommendations">
                            <div class="recommendation-item">
                                <div class="recommendation-title">AIåˆ†æã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</div>
                                <div class="recommendation-desc">å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€AIåˆ†æãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ãªæŠ€è¡“åˆ†æã‚’é–‹å§‹ã—ã¾ã™ã€‚</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- é€²æ­©è¨˜éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="progress" class="section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-value">78.5</div>
                    <div class="stat-label">å¹³å‡ã‚¹ã‚³ã‚¢</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ¿</div>
                    <div class="stat-value">24</div>
                    <div class="stat-label">åˆ†æå›æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ†</div>
                    <div class="stat-value">+12.3</div>
                    <div class="stat-label">ä»Šæœˆã®æ”¹å–„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â­</div>
                    <div class="stat-value">ä¸­ç´š</div>
                    <div class="stat-label">ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«</div>
                </div>
            </div>

            <div class="progress-history">
                <h3 class="card-title">
                    <span>ğŸ“Š</span>
                    åˆ†æå±¥æ­´
                </h3>
                <div class="history-item">
                    <div>
                        <div style="font-weight: 600;">2024/8/15 - å¤§å›ã‚Šã‚¿ãƒ¼ãƒ³ç·´ç¿’</div>
                        <div class="history-date">åˆå¾Œã®ç·´ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
                    </div>
                    <div>
                        <div class="history-score">85</div>
                        <div class="improvement">+3.2</div>
                    </div>
                </div>
                <div class="history-item">
                    <div>
                        <div style="font-weight: 600;">2024/8/12 - ã‚«ãƒ¼ãƒ“ãƒ³ã‚°ã‚¿ãƒ¼ãƒ³</div>
                        <div class="history-date">æœç·´ç¿’</div>
                    </div>
                    <div>
                        <div class="history-score">82</div>
                        <div class="improvement">+1.8</div>
                    </div>
                </div>
                <div class="history-item">
                    <div>
                        <div style="font-weight: 600;">2024/8/10 - å°å›ã‚Šã‚¿ãƒ¼ãƒ³å¼·åŒ–</div>
                        <div class="history-date">é›†ä¸­ç·´ç¿’</div>
                    </div>
                    <div>
                        <div class="history-score">76</div>
                        <div class="decline">-2.1</div>
                    </div>
                </div>
                <div class="history-item">
                    <div>
                        <div style="font-weight: 600;">2024/8/8 - åŸºæœ¬ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèª</div>
                        <div class="history-date">ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯</div>
                    </div>
                    <div>
                        <div class="history-score">79</div>
                        <div class="improvement">+4.5</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="training" class="section">
            <div class="analysis-card">
                <h3 class="card-title">
                    <span>ğŸ‹ï¸</span>
                    å€‹åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                </h3>
                <div class="recommendations">
                    <div class="recommendation-item">
                        <div class="recommendation-title">åŸºæœ¬å§¿å‹¢æ”¹å–„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</div>
                        <div class="recommendation-desc">
                            â€¢ å£éš›ã§ã®å‰å‚¾å§¿å‹¢ç·´ç¿’ (10åˆ†Ã—3ã‚»ãƒƒãƒˆ)<br>
                            â€¢ ãƒãƒ©ãƒ³ã‚¹ãƒœãƒ¼ãƒ«ã‚’ä½¿ã£ãŸä½“å¹¹å¼·åŒ–<br>
                            â€¢ é¡ã®å‰ã§ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-title">ã‚¨ãƒƒã‚¸ãƒ³ã‚°æŠ€è¡“å‘ä¸Š</div>
                        <div class="recommendation-desc">
                            â€¢ å¹³åœ°ã§ã®è·é‡ç§»å‹•ç·´ç¿’<br>
                            â€¢ ç‰‡è¶³ã‚¹ã‚­ãƒ¼ã§ã®ãƒãƒ©ãƒ³ã‚¹ç·´ç¿’<br>
                            â€¢ ã‚†ã‚‹ã„æ–œé¢ã§ã®è§’ä»˜ã‘æ„Ÿè¦šé¤Šæˆ
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-title">ã‚¿ãƒ¼ãƒ³æŠ€è¡“å¼·åŒ–</div>
                        <div class="recommendation-desc">
                            â€¢ å¤§å›ã‚Šâ†’å°å›ã‚Šæ®µéšçš„ç·´ç¿’<br>
                            â€¢ ãƒªã‚ºãƒ å¤‰åŒ–ã«å¯¾å¿œã™ã‚‹ç·´ç¿’<br>
                            â€¢ ã‚³ãƒ¼ãƒ³ã‚’ä½¿ã£ãŸãƒ©ã‚¤ãƒ³å–ã‚Šç·´ç¿’
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- AIåˆ†æå®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="analysisModal" class="modal hidden">
        <div class="modal-content">
            <h3>âœ… AIåˆ†æå®Œäº†</h3>
            <p>æ»‘èµ°å‹•ç”»ã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
            <p>è©³ç´°ãªçµæœã¨æ”¹å–„ææ¡ˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
            <div style="margin-top: 30px;">
                <button class="control-btn btn-primary" onclick="closeAnalysisModal()">ç¢ºèª</button>
            </div>
        </div>
    </div>

    <script>
        class SkiAnalyzer {
            constructor() {
                this.currentSection = 'upload';
                this.currentVideoType = 'file'; // 'file' or 'youtube'
                this.analysisData = {
                    posture: 0,
                    edging: 0,
                    turning: 0,
                    rhythm: 0,
                    line: 0,
                    speed: 0
                };
                this.analysisHistory = JSON.parse(localStorage.getItem('skiAnalysis') || '[]');
                
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const section = e.target.dataset.section;
                        this.switchSection(section);
                    });
                });

                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                const uploadArea = document.getElementById('uploadArea');
                const videoInput = document.getElementById('videoInput');

                uploadArea.addEventListener('click', () => videoInput.click());
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });

                videoInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });

                // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®æ‰‹å‹•æ“ä½œ
                document.querySelectorAll('.checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', (e) => {
                        const category = e.target.dataset.category;
                        this.toggleCheckbox(category);
                    });
                });
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.upload-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const type = e.target.dataset.type;
                        this.switchUploadType(type);
                    });
                });
                
                // YouTubeURLå…¥åŠ›ã§Enterã‚­ãƒ¼
                document.getElementById('youtubeUrl').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.loadYouTubeVideo();
                    }
                });
            }

            switchSection(section) {
                // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-section="${section}"]`).classList.add('active');

                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ‡æ›¿
                document.querySelectorAll('.section').forEach(sec => {
                    sec.classList.remove('active');
                });
                document.getElementById(section).classList.add('active');

                this.currentSection = section;
            }

            handleFiles(files) {
                const file = files[0];
                if (!file || !file.type.startsWith('video/')) {
                    alert('å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }

                if (file.size > 100 * 1024 * 1024) { // 100MBåˆ¶é™
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯100MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„');
                    return;
                }

                // å‹•ç”»ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
                const videoURL = URL.createObjectURL(file);
                const videoPlayer = document.getElementById('videoPlayer');
                videoPlayer.src = videoURL;

                // åˆ†æãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
                document.getElementById('analysisPanel').classList.remove('hidden');
                
                // ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ
                this.resetAnalysis();
                
                // å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¡¨ç¤º
                this.showVideoPlayer('file');
            }

            resetAnalysis() {
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒªã‚»ãƒƒãƒˆ
                document.querySelectorAll('.checkbox').forEach(checkbox => {
                    checkbox.classList.remove('checked');
                    checkbox.innerHTML = '';
                });

                // ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ
                this.updateTotalScore(0);
                
                // æ¨å¥¨äº‹é …ãƒªã‚»ãƒƒãƒˆ
                const recommendations = document.getElementById('recommendations');
                recommendations.innerHTML = `
                    <div class="recommendation-item">
                        <div class="recommendation-title">AIåˆ†æã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</div>
                        <div class="recommendation-desc">å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€AIåˆ†æãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ãªæŠ€è¡“åˆ†æã‚’é–‹å§‹ã—ã¾ã™ã€‚</div>
                    </div>
                `;
            }

            toggleCheckbox(category) {
                const checkbox = document.querySelector(`[data-category="${category}"]`);
                const isChecked = checkbox.classList.contains('checked');
                
                if (!isChecked) {
                    checkbox.classList.add('checked');
                    checkbox.innerHTML = 'âœ“';
                    this.analysisData[category] = 1;
                } else {
                    checkbox.classList.remove('checked');
                    checkbox.innerHTML = '';
                    this.analysisData[category] = 0;
                }
                
                this.updateTotalScore();
            }

            updateTotalScore(manualScore = null) {
                let score;
                if (manualScore !== null) {
                    score = manualScore;
                } else {
                    const total = Object.values(this.analysisData).reduce((sum, val) => sum + val, 0);
                    score = Math.round((total / 6) * 100);
                }
                
                const scoreCircle = document.querySelector('.score-circle');
                const scoreNumber = document.getElementById('totalScore');
                
                scoreCircle.style.setProperty('--score', `${score}%`);
                scoreNumber.textContent = score;
            }

            analyzeVideo() {
                // AIåˆ†æã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const analysisButton = document.querySelector('[onclick="analyzeVideo()"]');
                analysisButton.innerHTML = 'â³ åˆ†æä¸­...';
                analysisButton.disabled = true;

                // 2ç§’å¾Œã«çµæœè¡¨ç¤º
                setTimeout(() => {
                    this.performAnalysis();
                    analysisButton.innerHTML = 'ğŸ” AIåˆ†æé–‹å§‹';
                    analysisButton.disabled = false;
                }, 2000);
            }

            performAnalysis() {
                // ãƒ©ãƒ³ãƒ€ãƒ ãªåˆ†æçµæœã‚’ç”Ÿæˆï¼ˆå®Ÿéš›ã®AIåˆ†æã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
                const categories = ['posture', 'edging', 'turning', 'rhythm', 'line', 'speed'];
                const scores = {};
                let totalChecked = 0;

                categories.forEach(category => {
                    const score = Math.random() > 0.3 ? 1 : 0; // 70%ã®ç¢ºç‡ã§è‰¯ã„è©•ä¾¡
                    scores[category] = score;
                    totalChecked += score;
                    
                    const checkbox = document.querySelector(`[data-category="${category}"]`);
                    if (score) {
                        checkbox.classList.add('checked');
                        checkbox.innerHTML = 'âœ“';
                    } else {
                        checkbox.classList.remove('checked');
                        checkbox.innerHTML = '';
                    }
                });

                this.analysisData = scores;
                this.updateTotalScore();
                this.generateRecommendations();
                
                // åˆ†æå®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
                document.getElementById('analysisModal').classList.remove('hidden');

                // åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                this.saveAnalysisResult();
            }

            generateRecommendations() {
                const recommendations = document.getElementById('recommendations');
                const issues = [];
                
                if (!this.analysisData.posture) {
                    issues.push({
                        title: 'åŸºæœ¬å§¿å‹¢ã®æ”¹å–„',
                        desc: 'å‰å‚¾å§¿å‹¢ã¨é‡å¿ƒã®ä½ç½®ã‚’è¦‹ç›´ã—ã¾ã—ã‚‡ã†ã€‚è†ã®æ›²ã’è§’åº¦ã¨ä¸Šä½“ã®å‰å‚¾ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚'
                    });
                }
                
                if (!this.analysisData.edging) {
                    issues.push({
                        title: 'ã‚¨ãƒƒã‚¸ãƒ³ã‚°æŠ€è¡“ã®å‘ä¸Š',
                        desc: 'ã‚¹ã‚­ãƒ¼ã®è§’ä»˜ã‘ãŒä¸ååˆ†ã§ã™ã€‚å†…è„šã®è·é‡ç§»å‹•ã¨å¤–è„šã¸ã®ä½“é‡ç§»å‹•ã‚’ç·´ç¿’ã—ã¦ãã ã•ã„ã€‚'
                    });
                }
                
                if (!this.analysisData.turning) {
                    issues.push({
                        title: 'ã‚¿ãƒ¼ãƒ³æŠ€è¡“ã®å¼·åŒ–',
                        desc: 'ã‚¿ãƒ¼ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆãŒã‚¹ãƒ ãƒ¼ã‚ºã§ã‚ã‚Šã¾ã›ã‚“ã€‚é‡å¿ƒç§»å‹•ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚'
                    });
                }
                
                if (!this.analysisData.rhythm) {
                    issues.push({
                        title: 'ãƒªã‚ºãƒ ãƒ»ãƒãƒ©ãƒ³ã‚¹ã®æ”¹å–„',
                        desc: 'æ»‘èµ°ãƒªã‚ºãƒ ãŒä¸€å®šã§ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ ã«åˆã‚ã›ãŸç·´ç¿’ã‚’æ¨å¥¨ã—ã¾ã™ã€‚'
                    });
                }
                
                if (!this.analysisData.line) {
                    issues.push({
                        title: 'ãƒ©ã‚¤ãƒ³å–ã‚Šã®æœ€é©åŒ–',
                        desc: 'ã‚¿ãƒ¼ãƒ³å¼§ãŒå¤§ãã™ãã¾ã™ã€‚ã‚ˆã‚ŠåŠ¹ç‡çš„ãªãƒ©ã‚¤ãƒ³ã‚’æãã‚ˆã†æ„è­˜ã—ã¦ãã ã•ã„ã€‚'
                    });
                }
                
                if (!this.analysisData.speed) {
                    issues.push({
                        title: 'ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®å‘ä¸Š',
                        desc: 'ã‚¹ãƒ”ãƒ¼ãƒ‰ã®èª¿ç¯€ãŒä¸å®‰å®šã§ã™ã€‚ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹æ¸›é€ŸæŠ€è¡“ã‚’ç¿’å¾—ã—ã¦ãã ã•ã„ã€‚'
                    });
                }

                if (issues.length === 0) {
                    recommendations.innerHTML = `
                        <div class="recommendation-item">
                            <div class="recommendation-title">ğŸ‰ ç´ æ™´ã‚‰ã—ã„æ»‘èµ°ã§ã™ï¼</div>
                            <div class="recommendation-desc">ã™ã¹ã¦ã®æŠ€è¡“é …ç›®ã§è‰¯å¥½ãªè©•ä¾¡ã§ã™ã€‚ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ã‚’ç¶­æŒã—ã€ã‚ˆã‚Šé«˜åº¦ãªæŠ€è¡“ã«æŒ‘æˆ¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</div>
                        </div>
                    `;
                } else {
                    recommendations.innerHTML = issues.map(issue => `
                        <div class="recommendation-item">
                            <div class="recommendation-title">${issue.title}</div>
                            <div class="recommendation-desc">${issue.desc}</div>
                        </div>
                    `).join('');
                }
            }

            saveAnalysisResult() {
                const result = {
                    date: new Date().toISOString(),
                    score: Math.round((Object.values(this.analysisData).reduce((sum, val) => sum + val, 0) / 6) * 100),
                    details: { ...this.analysisData }
                };

                this.analysisHistory.unshift(result);
                this.analysisHistory = this.analysisHistory.slice(0, 20); // æœ€æ–°20ä»¶ã¾ã§ä¿å­˜
                localStorage.setItem('skiAnalysis', JSON.stringify(this.analysisHistory));
            }
            
            switchUploadType(type) {
                this.currentVideoType = type;
                
                // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.upload-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-type="${type}"]`).classList.add('active');
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.upload-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(type === 'file' ? 'fileUpload' : 'youtubeUpload').classList.add('active');
            }
            
            parseYouTubeUrl(url) {
                // YouTube URLã‹ã‚‰ãƒ“ãƒ‡ã‚ªIDã‚’æŠ½å‡º
                const patterns = [
                    /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/v\/([a-zA-Z0-9_-]{11})/
                ];
                
                for (let pattern of patterns) {
                    const match = url.match(pattern);
                    if (match) {
                        return match[1];
                    }
                }
                return null;
            }
            
            loadYouTubeVideo() {
                const urlInput = document.getElementById('youtubeUrl');
                const url = urlInput.value.trim();
                
                if (!url) {
                    alert('YouTube URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                const videoId = this.parseYouTubeUrl(url);
                if (!videoId) {
                    alert('æœ‰åŠ¹ãªYouTube URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nä¾‹: https://www.youtube.com/watch?v=VIDEO_ID');
                    return;
                }
                
                // YouTubeåŸ‹ã‚è¾¼ã¿å‹•ç”»ã‚’è¨­å®š
                const youtubePlayer = document.getElementById('youtubePlayer');
                const embedUrl = `https://www.youtube.com/embed/${videoId}?enablejsapi=1&controls=1`;
                youtubePlayer.src = embedUrl;
                
                // å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¡¨ç¤º
                this.showVideoPlayer('youtube');
                
                // åˆ†æãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
                document.getElementById('analysisPanel').classList.remove('hidden');
                
                // åˆ†æãƒªã‚»ãƒƒãƒˆ
                this.resetAnalysis();
                
                alert('YouTubeå‹•ç”»ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼AIåˆ†æãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ†æã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚');
            }
            
            showVideoPlayer(type) {
                const videoPlayer = document.getElementById('videoPlayer');
                const youtubePlayer = document.getElementById('youtubePlayer');
                
                if (type === 'file') {
                    videoPlayer.style.display = 'block';
                    youtubePlayer.style.display = 'none';
                } else {
                    videoPlayer.style.display = 'none';
                    youtubePlayer.style.display = 'block';
                }
            }

            playSlowMotion() {
                if (this.currentVideoType === 'file') {
                    const video = document.getElementById('videoPlayer');
                    video.playbackRate = 0.5;
                    video.play();
                } else {
                    // YouTubeå‹•ç”»ã®å ´åˆã¯é€šå¸¸å†ç”Ÿï¼ˆAPIåˆ¶é™ã®ãŸã‚ï¼‰
                    alert('YouTubeå‹•ç”»ã§ã¯ã‚¹ãƒ­ãƒ¼å†ç”Ÿæ©Ÿèƒ½ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚å…ƒã®å‹•ç”»ã§ã‚¹ãƒ­ãƒ¼å†ç”Ÿã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                }
            }

            frameByFrame() {
                if (this.currentVideoType === 'file') {
                    const video = document.getElementById('videoPlayer');
                    if (video.paused) {
                        video.currentTime += 1/30; // 1ãƒ•ãƒ¬ãƒ¼ãƒ é€²ã‚ã‚‹ï¼ˆ30fpsæƒ³å®šï¼‰
                    } else {
                        video.pause();
                    }
                } else {
                    alert('YouTubeå‹•ç”»ã§ã¯ã‚³ãƒé€ã‚Šæ©Ÿèƒ½ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚å…ƒã®å‹•ç”»ã§ã‚³ãƒé€ã‚Šã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                }
            }

            resetVideo() {
                if (this.currentVideoType === 'file') {
                    const video = document.getElementById('videoPlayer');
                    video.currentTime = 0;
                    video.playbackRate = 1;
                    video.pause();
                } else {
                    // YouTubeå‹•ç”»ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
                    const youtubePlayer = document.getElementById('youtubePlayer');
                    const currentSrc = youtubePlayer.src;
                    youtubePlayer.src = currentSrc;
                }
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        function analyzeVideo() {
            analyzer.analyzeVideo();
        }
        
        function loadYouTubeVideo() {
            analyzer.loadYouTubeVideo();
        }

        function playSlowMotion() {
            analyzer.playSlowMotion();
        }

        function frameByFrame() {
            analyzer.frameByFrame();
        }

        function resetVideo() {
            analyzer.resetVideo();
        }

        function closeAnalysisModal() {
            document.getElementById('analysisModal').classList.add('hidden');
        }

        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        const analyzer = new SkiAnalyzer();
    </script>
</body>
</html>